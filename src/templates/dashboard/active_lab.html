{% extends 'dashboard/dashboard_base.html' %}

{% block title %}Active lab | {{ block.super }}{% endblock %}
{% block page_header %}Active lab{% endblock %}

{% block page-content %}

<div class="uk-container">

  {% comment %}
  Show a spinner while we're waiting to see whether the user has started
  any lab environments and, if so, whether or not they're already up and
  running.
  {% endcomment %}
  <div class="uk-text-center uk-container uk-margin-top">
    <div uk-spinner="ratio: 5" id="active-lab-waiting">
    </div>
  </div>

  <div class="uk-width-1-2@m uk-container">

    {% comment %}
    Status card to display when the user doesn't have any running labs.
    {% endcomment %}
    <div id="no-active-lab" class="uk-card uk-card-body uk-card-default lab-status-card">
      <h2 class="uk-card-title">
        No active environments found
      </h2>
      <p>
        Start a new environment from the list of labs, or refresh the page to check whether an active environment already exists.
      </p>

      <div uk-grid>
        <div>
          <button class="uk-button uk-button-secondary" type="button" onClick="window.location.replace('{% url "available labs" %}');">
            View available labs
          </button>
        </div>

        <div>
          <button class="uk-button uk-button-secondary" type="button" value="Refresh page" onClick="window.location.reload();">
            <span uk-icon="icon: refresh"></span>
            Refresh page
          </button>
        </div>
      </div>
    </div>

    {% comment %}
    Status card to display when we're waiting for a lab to start.
    {% endcomment %}
    <div id="lab-loading" class="uk-card uk-card-body uk-card-default lab-status-card">
      <h2 class="uk-card-title">
        Waiting for the lab to start...
      </h2>
      <p>
        We're currently waiting for your environment to load. You will be notified when the lab is ready.
      </p>
      <button class="uk-button uk-button-primary" type="button" disabled>
        <span uk-spinner></span>
        Loading...
      </button>
    </div>
    </div>

    {% comment %}
    iframe providing access to a lab environment's web interface.
    {% endcomment %}
    <div id="lab-interface" class="vnc-wrapper" style="display: none;">
      {% comment %}
      <template> containing the iframe that we'll need to use in order to render the noVNC desktop.
      This is in a template rather than inserted directly into the page so that we don't have to try
      to wait for the iframe to load before the document is ready.
      {% endcomment %}
      <template id="vnc-iframe">
        <iframe src="/vnc/{{ user.get_username }}/vnc.html" class="vnc-wrapper" allowfullscreen="true"></iframe>
      </template>
    </div>

  {# end uk-container-center #}
  </div>
{# end uk-container #}
</div>
{% endblock %}

{% block javascripts %}
{{ block.super }}
{% load static %}
<script type="application/javascript"
  src="{% static 'js/active-labs.js' %}"></script>
{% endblock %}
